<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">
<link rel="import" href="../bower_components/sortable-table/sortable-table.html">
<link rel="import" href="../bower_components/core-list/core-list.html">

<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-header.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-footer.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-job-no-ready.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-project-browser.html">

<link rel="import" href="jso-pathivar-form.html">
<link rel="import" href="jso-pathiways-form.html">
<link rel="import" href="jso-pathipred-form.html">
<link rel="import" href="jso-pathivar-result.html">

<link rel="import" href="../lib/jsorolla/src/network-viewer/jso-network-viewer.html">

<link rel="import" href="pathiways-home.html">
<link rel="import" href="pathiways-menu.html">

<polymer-element name="pathiways-element">
    <template>
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-style.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-panel.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-form.css">
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-dropdown.css">
        <style>
            :host {
                display: block;
                position: relative;
                cursor: default;
                font-size: 13px;
            }

            .content {
                background-color: #435f7a;
                position: relative;
                /*min-height: calc(100vh - 160px);*/
            }

            .content > * {
                min-height: calc(100vh - 160px);
            }

            .a {
                text-decoration: none;
                color: #CCCCCC;
                cursor: pointer;
            }

            .a:visited {
                color: #CCCCCC;
            }

            .a:hover {
                color: white;
                /*text-decoration: underline;*/
            }

            jso-project-browser {
                height: calc(100vh - 160px);
            }

            pathivar-result {
                /*height: calc(100vh - 60px);*/
            }
        </style>
        <jso-header id="jsoHeader"
                    isLogged="{{isLogged}}"
                    on-session-change="{{handleSessionChange}}"

                    selectedOption="{{selectedOption}}"
                    userData="{{userData}}"
                    showJobs="{{showJobs}}"
                    options="{{options}}"
                    studies="{{studies}}"
                    selectedStudy="{{selectedStudy}}"
                    allowedTools="{{allowedTools}}"
                    jobItem="{{jobItem}}">
             <span class="icon">
                    <img src="images/pathiways-logo.svg" style="height: 54px;margin: 1px 5px 0 0;">
            </span>
            <span class="title">PATHiVAR</span>
                        <span class="description">
            </span>
            <!--<span class="description">Pathway analysis tool</span>-->

            <pathiways-menu class="menu" selectedOption="{{selectedOption}}">
            </pathiways-menu>
            <jso-help-menu class="helpmenu" selectedOption="{{selectedOption}}">
                <div class="link">
                    <font-awesome icon="book"></font-awesome>
                    <a class="a" href="https://github.com/babelomics/pathiways/wiki/Pathivar-documentation"
                       target="_blank">
                        &nbsp; Documentation
                    </a>
                </div>
                <div class="link">
                    <font-awesome icon="compass"></font-awesome>
                    <a class="a" href="https://github.com/babelomics/pathiways/wiki/Pathivar-tutorial" target="_blank">
                        &nbsp; Tutorial
                    </a>
                </div>
            </jso-help-menu>
        </jso-header>


        <div class="content">
            <template if="{{selectedOption == 'projects' }}">
                <jso-project-browser
                        userData="{{userData}}"
                        studies="{{studies}}"
                        selectedStudy="{{selectedStudy}}"
                        selectedProject="{{selectedProject}}">
                </jso-project-browser>
            </template>

            <template if="{{ selectedOption == 'home' || selectedOption == '' }}">
                <pathiways-home
                        id="pathiwaysHome"
                        on-annonymous="{{annonymousLogin}}"
                        isLogged="{{isLogged}}">

                </pathiways-home>
            </template>
            <template if="{{ selectedOption == 'pathiways' }}">
                <jso-pathiways-form
                        selectedOption="{{selectedOption}}"
                        studies="{{studies}}"
                        selectedStudy="{{selectedStudy}}"
                        ></jso-pathiways-form>
            </template>
            <template if="{{ selectedOption == 'pathipred' }}">
                <jso-pathipred-form
                        selectedOption="{{selectedOption}}"
                        studies="{{studies}}"
                        selectedStudy="{{selectedStudy}}"
                        ></jso-pathipred-form>
            </template>
            <template if="{{ selectedOption == 'pathivar' }}">
                <jso-pathivar-form
                        selectedOption="{{selectedOption}}"
                        studies="{{studies}}"
                        selectedStudy="{{selectedStudy}}"
                        ></jso-pathivar-form>
            </template>
            <template if="{{ selectedOption == 'jobReady' }}">
                <jso-pathivar-result jobItem="{{jobItem}}"></jso-pathivar-result>
            </template>
            <template if="{{ selectedOption == 'jobNoReady' }}">
                <jso-job-no-ready jobItem="{{jobItem}}"></jso-job-no-ready>
            </template>
        </div>
        <jso-footer>
            PATHiVAR
            <br>
            <span style="font-weight:bold;">Computational Genomics Department</span>
            <br>
            Principe Felipe Research Center, Valencia, Spain
            <br>
            2015
        </jso-footer>

    </template>
    <script>
        Polymer({
            created: function () {
                this.selectedOption = 'home';

                this.showJobs = false;
                this.userData;


                this.isLogged

                this.selectedProject;
                this.selectedStudy;
                this.studies;

                this.jobItem;

                this.allowedTools = ['pathiways'];

                this.options = [
//                    {
//                    option: 'pathivar',
//                    text: 'PATHiWAYS'
//                }
//                    ,{
//                    option: 'pathivar',
//                    text: 'PATHiPRED'
//                },
                    {
                        option: 'pathivar',
                        text: 'Run'
                    }
                ]
            },
            ready: function () {
                var me = this;
//                this.selectedOption = 'pathivar';
//                this.selectedOption = 'projects';
            },
            selectedOptionChanged: function (oldValue, newValue) {
                if (this.selectedOption == "pathivar" && this.$.jsoHeader.isLogged == false) {
                    this.$.jsoHeader.anonymousSign();
                }
            },
            handleSessionChange: function () {
                this.selectedOption = "pathivar";
            },

            userDataChanged: function (oldValue, newValue) {
                var me = this;
                this.selectedProject = this.userData.projects[0];

                OpencgaManager.projects.studies({
                    id: this.selectedProject.id,
                    query: {
                        sid: Cookies("bioinfo_sid")
                    },
                    request: {
                        //method: 'POST',
                        success: function (response) {
                            if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                me.studies = response.response[0].result;
                                me.selectedStudy = me.studies[0];
                            } else {
                                console.log(response.error);
                                console.log(response.response[0].errorMsg);
                            }
                        },
                        error: function () {
                            console.log('Server error, try again later.');
                        }
                    }
                })
            },
            annonymousLogin: function () {
                this.$.jsoHeader.anonymousSign();
            }
        });
    </script>
</polymer-element>
